# åŸŸåç›‘æ§æœåŠ¡ (Domain Monitor)

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¼‚æ­¥åŸŸåç›‘æ§æœåŠ¡ï¼Œé›†æˆCloudflare APIç®¡ç†ï¼Œæ”¯æŒæ‰¹é‡æ£€æŸ¥åŸŸåå¯ç”¨æ€§å¹¶é€šè¿‡Telegram Botè¿›è¡Œå®æ—¶é€šçŸ¥å’Œè¿œç¨‹æ§åˆ¶ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ” åŸŸåç›‘æ§
- **æ‰¹é‡åŸŸåç›‘æ§** - æ”¯æŒåŒæ—¶ç›‘æ§æ•°ç™¾ä¸ªåŸŸå
- **é«˜æ€§èƒ½å¼‚æ­¥æ£€æŸ¥** - ä½¿ç”¨ asyncio å’Œè¿æ¥æ± æŠ€æœ¯  
- **æ™ºèƒ½é‡è¯•æœºåˆ¶** - ä»…å¯¹è¶…æ—¶å’Œè¿æ¥é”™è¯¯è¿›è¡Œé‡è¯•
- **è‡ªé€‚åº”å¹¶å‘æ§åˆ¶** - æ ¹æ®ç³»ç»Ÿèµ„æºè‡ªåŠ¨è°ƒæ•´å¹¶å‘æ•°
- **å®æ—¶è¿›åº¦æ˜¾ç¤º** - æ˜¾ç¤ºæ£€æŸ¥è¿›åº¦å’Œé¢„è®¡å®Œæˆæ—¶é—´

### ğŸŒ Cloudflare é›†æˆ
- **å¤šç”¨æˆ·API Tokenç®¡ç†** - æ¯ä¸ªç”¨æˆ·å¯ç®¡ç†å¤šä¸ªCloudflareè´¦å·
- **åŸŸåæ‰¹é‡æ“ä½œ** - è·å–ã€å¯¼å‡ºå’ŒåŒæ­¥åŸŸååˆ°ç›‘æ§ç³»ç»Ÿ
- **æƒé™éªŒè¯** - Tokenæœ‰æ•ˆæ€§æ£€æŸ¥å’Œæƒé™éªŒè¯
- **å¤šæ ¼å¼å¯¼å‡º** - æ”¯æŒtxtã€jsonã€csvæ ¼å¼åŸŸåå¯¼å‡º

### ğŸ“± Telegram Bot
- **å®æ—¶é€šçŸ¥** - åŸŸåçŠ¶æ€å˜åŒ–å³æ—¶é€šçŸ¥
- **è¿œç¨‹æ§åˆ¶** - é€šè¿‡Telegramå‘½ä»¤ç®¡ç†æ•´ä¸ªç›‘æ§ç³»ç»Ÿ
- **çƒ­é…ç½®æ›´æ–°** - å¤§éƒ¨åˆ†é…ç½®æ”¯æŒåœ¨çº¿ä¿®æ”¹ï¼Œæ— éœ€é‡å¯
- **æ™ºèƒ½é€šçŸ¥æ¨¡å¼** - æ”¯æŒå®Œæ•´æ¨¡å¼å’Œæ™ºèƒ½æ¨¡å¼é€šçŸ¥

### ğŸ›¡ï¸ ç”Ÿäº§ç‰¹æ€§
- **å¤šç§éƒ¨ç½²æ–¹å¼** - æ”¯æŒsystemd/Docker/PM2éƒ¨ç½²
- **é…ç½®çƒ­é‡è½½** - æ”¯æŒé…ç½®æ–‡ä»¶åŠ¨æ€æ›´æ–°
- **æ—¥å¿—ç®¡ç†** - è½®è½¬æ—¥å¿—å’Œå¯é…ç½®æ—¥å¿—çº§åˆ«
- **é”™è¯¯è¿½è¸ª** - è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œç»Ÿè®¡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- pip å’Œ venvï¼ˆæ¨èï¼‰

### 1. é¡¹ç›®åˆå§‹åŒ–
```bash
# å…‹éš†é¡¹ç›®
git clone <repository_url>
cd domain-monitor

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®è®¾ç½®
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config_example.json config.json
cp cloudflare_tokens.example.json cloudflare_tokens.json  # å¯é€‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º
```

### 3. åŸºç¡€é…ç½®
ç¼–è¾‘ `config.json` æ–‡ä»¶ï¼š
```json
{
  "telegram": {
    "bot_token": "YOUR_BOT_TOKEN",      // ä» @BotFather è·å–
    "chat_id": "-1001234567890",        // ç¾¤ç»„IDï¼ˆè´Ÿæ•°ï¼‰
    "admin_users": ["@your_username"]   // ç®¡ç†å‘˜ç”¨æˆ·ååˆ—è¡¨
  },
  "domains": [
    "https://example.com",
    "https://test.com"
  ],
  "check": {
    "interval_minutes": 30,
    "max_concurrent": 10,
    "timeout_seconds": 14
  }
}
```

### 4. è¿è¡ŒæœåŠ¡

#### å¼€å‘ç¯å¢ƒ
```bash
python src/main.py
```

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**Linux ä¸€é”®éƒ¨ç½²ï¼š**
```bash
chmod +x deploy.sh
./deploy.sh
```

**Windows ä¸€é”®éƒ¨ç½²ï¼š**
```batch
deploy.bat
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
domain-monitor/
â”œâ”€â”€ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.py                   # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ domain_checker.py         # åŸŸåæ£€æŸ¥æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ telegram_bot.py           # Telegramæœºå™¨äººæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ telegram_notifier.py      # é€šçŸ¥å‘é€å™¨
â”‚   â”œâ”€â”€ config_manager.py         # é…ç½®ç®¡ç†å™¨ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
â”‚   â”œâ”€â”€ cloudflare_manager.py     # Cloudflare APIç®¡ç†å™¨
â”‚   â””â”€â”€ error_tracker.py          # é”™è¯¯ç»Ÿè®¡å’Œè¿½è¸ª
â”œâ”€â”€ config.json                   # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ config_example.json           # é…ç½®æ¨¡æ¿
â”œâ”€â”€ domains.json                  # å¤–éƒ¨åŸŸååˆ—è¡¨æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ cloudflare_tokens.json        # Cloudflare Tokenå­˜å‚¨
â”œâ”€â”€ cloudflare_tokens.example.json # Tokené…ç½®ç¤ºä¾‹
â”œâ”€â”€ deploy.sh                     # Linuxéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ deploy.bat                    # Windowséƒ¨ç½²è„šæœ¬
â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â””â”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
```

## ğŸ¤– Telegram Bot å‘½ä»¤å‚è€ƒ

### åŸºç¡€ç›‘æ§å‘½ä»¤
- `/help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `/start` - å¯åŠ¨æ¶ˆæ¯å’ŒåŸºæœ¬ä¿¡æ¯
- `/status` - æŸ¥çœ‹å½“å‰ç›‘æ§çŠ¶æ€
- `/list` - æŸ¥çœ‹æ‰€æœ‰ç›‘æ§åŸŸå
- `/check` - ç«‹å³æ‰§è¡Œä¸€æ¬¡æ£€æŸ¥
- `/errors` - æŸ¥çœ‹å½“å‰é”™è¯¯çŠ¶æ€
- `/history` - æŸ¥çœ‹å†å²è®°å½•
- `/ack [domain]` - ç¡®è®¤å¤„ç†é”™è¯¯

### åŸŸåç®¡ç†ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰
- `/add example.com` - æ·»åŠ åŸŸååˆ°ç›‘æ§åˆ—è¡¨
- `/remove example.com` - ä»ç›‘æ§åˆ—è¡¨åˆ é™¤åŸŸå
- `/clear` - æ¸…ç©ºæ‰€æœ‰ç›‘æ§åŸŸå

### é…ç½®ç®¡ç†ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰
- `/config` - æ˜¾ç¤ºå½“å‰é…ç½®
- `/interval 30` - è®¾ç½®æ£€æŸ¥é—´éš”ï¼ˆåˆ†é’Ÿï¼Œ1-1440ï¼‰
- `/timeout 15` - è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼Œ1-300ï¼‰
- `/retry 3` - è®¾ç½®é‡è¯•æ¬¡æ•°ï¼ˆ0-10ï¼‰
- `/concurrent 20` - è®¾ç½®å¹¶å‘æ•°ï¼ˆ1-100ï¼‰
- `/autoadjust on` - å¼€å¯è‡ªé€‚åº”å¹¶å‘
- `/reload` - é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶

### Cloudflare é›†æˆå‘½ä»¤
- `/cfhelp` - æŸ¥çœ‹CloudflareåŠŸèƒ½å¸®åŠ©
- `/cftoken add åç§° TOKEN` - æ·»åŠ API Token
- `/cftoken remove åç§°` - åˆ é™¤API Token
- `/cflist` - æŸ¥çœ‹æˆ‘çš„Tokenåˆ—è¡¨
- `/cfverify åç§°` - éªŒè¯Tokenæœ‰æ•ˆæ€§
- `/cfzones åç§°` - è·å–Tokenä¸‹çš„æ‰€æœ‰åŸŸå
- `/cfexport åç§° [æ ¼å¼] [sync]` - å¯¼å‡ºå•ä¸ªTokenåŸŸå
- `/cfexportall [æ ¼å¼] [sync]` - å¯¼å‡ºæ‰€æœ‰TokenåŸŸååˆ°æ–‡ä»¶
- `/cfexportall merge|replace|add` - å¯¼å‡ºæ‰€æœ‰TokenåŸŸåå¹¶å®æ—¶åˆå¹¶åˆ°é…ç½®
- `/cfsync [åç§°] [æ¨¡å¼]` - åŒæ­¥CFåŸŸååˆ°ç›‘æ§é…ç½®ï¼ˆå®æ—¶å†™å…¥ï¼‰

### ç³»ç»Ÿç®¡ç†å‘½ä»¤
- `/admin list` - æŸ¥çœ‹ç®¡ç†å‘˜åˆ—è¡¨  
- `/admin add @username` - æ·»åŠ ç®¡ç†å‘˜
- `/admin remove @username` - ç§»é™¤ç®¡ç†å‘˜
- `/stop` - åœæ­¢ç›‘æ§æœåŠ¡
- `/restart` - é‡å¯ç›‘æ§æœåŠ¡
- `/dailyreport` - ç”Ÿæˆæ¯æ—¥æŠ¥å‘Š
- `/apikey` - æ›´æ–°HTTP APIå¯†é’¥

## âš™ï¸ è¯¦ç»†é…ç½®è¯´æ˜

### ä¸»é…ç½®æ–‡ä»¶ (config.json)

```json
{
  "telegram": {
    "bot_token": "YOUR_BOT_TOKEN",       // å¿…å¡«ï¼šTelegram Bot Token
    "chat_id": "-1001234567890",         // å¿…å¡«ï¼šç¾¤ç»„æˆ–ç”¨æˆ·ID
    "admin_users": ["@admin1"]           // ç®¡ç†å‘˜åˆ—è¡¨ï¼Œç©ºåˆ™æ‰€æœ‰äººå¯ç”¨
  },
  
  "check": {
    "interval_minutes": 30,              // æ£€æŸ¥é—´éš”ï¼ˆ1-1440åˆ†é’Ÿï¼‰
    "max_concurrent": 10,                // æœ€å¤§å¹¶å‘æ•°ï¼ˆ1-200ï¼‰
    "auto_adjust_concurrent": true,      // è‡ªé€‚åº”å¹¶å‘æ§åˆ¶
    "timeout_seconds": 14,               // è¯·æ±‚è¶…æ—¶ï¼ˆ1-300ç§’ï¼‰
    "retry_count": 2,                    // é‡è¯•æ¬¡æ•°ï¼ˆ0-10ï¼‰
    "retry_delay_seconds": 5,            // é‡è¯•å»¶è¿Ÿ
    "batch_notify": false,               // åˆ†æ‰¹é€šçŸ¥
    "show_eta": true                     // æ˜¾ç¤ºé¢„è®¡å®Œæˆæ—¶é—´
  },
  
  "domains": [                           // åŸŸååˆ—è¡¨ï¼ˆæˆ–æ–‡ä»¶è·¯å¾„ï¼‰
    "https://example.com",
    "https://test.com"
  ],
  // æˆ–ä½¿ç”¨å¤–éƒ¨æ–‡ä»¶ï¼š
  // "domains": "domains.json",
  
  "notification": {
    "level": "smart",                    // é€šçŸ¥æ¨¡å¼ï¼šsmart/full
    "notify_on_recovery": true,          // æ¢å¤æ—¶é€šçŸ¥
    "failure_threshold": 2,              // å¤±è´¥é˜ˆå€¼
    "cooldown_minutes": 60,              // å†·å´æ—¶é—´
    "quiet_on_success": false            // æˆåŠŸæ—¶é™é»˜
  },
  
  "logging": {
    "level": "INFO",                     // æ—¥å¿—çº§åˆ«
    "file": "domain_monitor.log",        // æ—¥å¿—æ–‡ä»¶
    "max_size_mb": 10,                   // æœ€å¤§æ–‡ä»¶å¤§å°
    "backup_count": 5                    // å¤‡ä»½æ–‡ä»¶æ•°
  },
  
  "history": {
    "enabled": true,                     // å†å²è®°å½•
    "retention_days": 30,                // ä¿ç•™å¤©æ•°
    "max_records": 10000                 // æœ€å¤§è®°å½•æ•°
  },
  
  "daily_report": {
    "enabled": false,                    // æ¯æ—¥æŠ¥å‘Š
    "time": "09:00"                      // å‘é€æ—¶é—´
  },
  
  "cloudflare": {
    "export": {
      "output_dir": "exports",           // å¯¼å‡ºæ–‡ä»¶ç›®å½•
      "default_format": "json",          // é»˜è®¤å¯¼å‡ºæ ¼å¼ï¼štxt, json, csv
      "include_timestamp": false,        // æ–‡ä»¶åæ˜¯å¦åŒ…å«æ—¶é—´æˆ³
      "single_file_name": "cf_domains_{token_name}.{format}",  // å•ä¸ªè´¦å·å¯¼å‡ºæ–‡ä»¶åæ¨¡æ¿
      "merged_file_name": "cf_all_domains.{format}",           // åˆå¹¶å¯¼å‡ºæ–‡ä»¶åæ¨¡æ¿
      "auto_create_dir": true,           // è‡ªåŠ¨åˆ›å»ºå¯¼å‡ºç›®å½•
      "sync_delete": true                // åŒæ­¥åˆ é™¤ï¼šå¯¼å‡ºæ—¶åˆ é™¤CFä¸­å·²ä¸å­˜åœ¨çš„åŸŸå
    }
  }
}
```

### å¤–éƒ¨åŸŸåæ–‡ä»¶ (domains.json)
```json
[
  "https://example1.com",
  "https://example2.com",  
  "https://api.example.com"
]
```

### Cloudflare Tokené…ç½®
```json
{
  "users": {
    "123456789": {                       // Telegramç”¨æˆ·ID
      "tokens": [
        {
          "name": "ä¸»è´¦å·",              // è‡ªå®šä¹‰åç§°
          "token": "your_token_here",    // API Token
          "permissions": ["Zone:Read", "DNS:Read"],
          "created_at": "2024-01-01T00:00:00",
          "status": "active"
        }
      ]
    }
  },
  "global_tokens": []                    // å…¨å±€Tokenï¼ˆç®¡ç†å‘˜ï¼‰
}
```

## ğŸŒ Cloudflare é›†æˆä½¿ç”¨æŒ‡å—

### API Token è·å–æ–¹æ³•
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ "My Profile" â†’ "API Tokens"
3. ç‚¹å‡» "Create Token"
4. é€‰æ‹© "Custom token" æ¨¡æ¿
5. è®¾ç½®æƒé™ï¼š
   - **Account**: Zone:Read
   - **Zone**: Zone:Read, DNS:Read
6. å¯é€‰æ‹©ç‰¹å®šåŸŸåæˆ–æ‰€æœ‰åŸŸå
7. åˆ›å»ºå¹¶å¤åˆ¶Token

### ä½¿ç”¨æµç¨‹

#### 1. æ·»åŠ Token
```
/cftoken add ä¸»è´¦å· your_cloudflare_api_token_here
```

#### 2. éªŒè¯Token
```
/cfverify ä¸»è´¦å·
```

#### 3. æŸ¥çœ‹åŸŸå
```
/cfzones ä¸»è´¦å·
```

#### 4. å¯¼å‡ºåŸŸå
```
# å¯¼å‡ºå•ä¸ªTokenåŸŸåï¼ˆä½¿ç”¨é…ç½®é»˜è®¤æ ¼å¼ï¼‰
/cfexport ä¸»è´¦å·

# å¯¼å‡ºä¸ºJSONæ ¼å¼å¹¶å¯ç”¨åŒæ­¥åˆ é™¤
/cfexport ä¸»è´¦å· json sync

# å¯¼å‡ºæ‰€æœ‰TokenåŸŸååˆ°åˆå¹¶æ–‡ä»¶
/cfexportall json sync
```

#### 5. åŒæ­¥åˆ°ç›‘æ§é…ç½®
```
# æŒ‡å®šTokençš„æ›¿æ¢æ¨¡å¼
/cfsync ä¸»è´¦å· replace

# æ‰€æœ‰Tokençš„æ›¿æ¢æ¨¡å¼ï¼ˆä¸å¡«Tokenåç§°ï¼‰
/cfsync replace

# æŒ‡å®šTokençš„åˆå¹¶æ¨¡å¼
/cfsync ä¸»è´¦å· merge

# æ‰€æœ‰Tokençš„åˆå¹¶æ¨¡å¼ï¼ˆä¸å¡«Tokenåç§°ï¼‰
/cfsync merge

# æŒ‡å®šTokençš„æ·»åŠ æ¨¡å¼
/cfsync ä¸»è´¦å· add

# æ‰€æœ‰Tokençš„æ·»åŠ æ¨¡å¼ï¼ˆä¸å¡«Tokenåç§°ï¼‰
/cfsync add
```

**cfsync åŒæ­¥æ¨¡å¼è¯¦è§£**ï¼š
- **`replace`** - å®Œå…¨æ›¿æ¢ç°æœ‰ç›‘æ§åŸŸå
  - æŒ‡å®šTokenï¼šç”¨è¯¥TokenåŸŸåæ›¿æ¢æ‰€æœ‰ç°æœ‰åŸŸå
  - ä¸æŒ‡å®šTokenï¼šç”¨æ‰€æœ‰TokenåŸŸåæ›¿æ¢æ‰€æœ‰ç°æœ‰åŸŸå
- **`merge`** - åˆå¹¶åŸŸåï¼ˆä¿ç•™ç°æœ‰ + æ·»åŠ CFåŸŸåï¼Œå»é‡ï¼‰
  - æŒ‡å®šTokenï¼šä¿ç•™ç°æœ‰åŸŸåï¼Œæ·»åŠ è¯¥Tokençš„æ–°åŸŸå
  - ä¸æŒ‡å®šTokenï¼šä¿ç•™ç°æœ‰åŸŸåï¼Œæ·»åŠ æ‰€æœ‰Tokençš„æ–°åŸŸå
- **`add`** - ä»…æ·»åŠ æ–°åŸŸåï¼ˆåªæ·»åŠ ç›‘æ§ä¸­ä¸å­˜åœ¨çš„CFåŸŸåï¼‰
  - æŒ‡å®šTokenï¼šåªæ·»åŠ è¯¥Tokenä¸­ç›‘æ§ä¸å­˜åœ¨çš„åŸŸå
  - ä¸æŒ‡å®šTokenï¼šåªæ·»åŠ æ‰€æœ‰Tokenä¸­ç›‘æ§ä¸å­˜åœ¨çš„åŸŸå

**Tokené€‰æ‹©è§„åˆ™**ï¼š
- æŒ‡å®šTokenåç§°ï¼šåªå¤„ç†è¯¥Tokençš„åŸŸå
- ä¸æŒ‡å®šTokenåç§°ï¼šå¤„ç†æ‰€æœ‰Tokençš„åŸŸå

**æ³¨æ„**ï¼šcfsync æ“ä½œè¿‡ç¨‹ä¸­ä¸ä¼šé¢‘ç¹å‘é€è¿›åº¦é€šçŸ¥ï¼Œåªåœ¨å®Œæˆæˆ–å‡ºé”™æ—¶é€šçŸ¥

### å¯¼å‡ºåŠŸèƒ½è¯¦è§£

#### å•ä¸ªTokenå¯¼å‡º (`/cfexport`)
- **åŸºæœ¬ç”¨æ³•**: `/cfexport ä¸»è´¦å·`
- **æŒ‡å®šæ ¼å¼**: `/cfexport ä¸»è´¦å· json`
- **å¯ç”¨åŒæ­¥åˆ é™¤**: `/cfexport ä¸»è´¦å· json sync`
- **æ”¯æŒæ ¼å¼**: txt, json, csv
- **æ–‡ä»¶è·¯å¾„**: `exports/cf_domains_ä¸»è´¦å·.json`

#### åˆå¹¶å¯¼å‡º (`/cfexportall`)
- **åŸºæœ¬ç”¨æ³•**: `/cfexportall`
- **æŒ‡å®šæ ¼å¼**: `/cfexportall txt`
- **å¯ç”¨åŒæ­¥åˆ é™¤**: `/cfexportall json sync`
- **åŠŸèƒ½**: åˆå¹¶æ‰€æœ‰Tokençš„åŸŸååˆ°ä¸€ä¸ªæ–‡ä»¶
- **æ–‡ä»¶è·¯å¾„**: `exports/cf_all_domains.json`

#### åŒæ­¥åˆ é™¤åŠŸèƒ½
- **ä½œç”¨**: è‡ªåŠ¨åˆ é™¤ç›‘æ§åˆ—è¡¨ä¸­CFå·²ä¸å­˜åœ¨çš„åŸŸå
- **è§¦å‘**: æ·»åŠ  `sync` å‚æ•°åˆ°å¯¼å‡ºå‘½ä»¤
- **å®‰å…¨**: åªåˆ é™¤ä¸åœ¨CFä¸­ä½†åœ¨ç›‘æ§åˆ—è¡¨ä¸­çš„åŸŸå

### å¤šè´¦å·ç®¡ç†ç¤ºä¾‹
```bash
# æ·»åŠ å¤šä¸ªè´¦å·
/cftoken add è´¦å·A token_a_here
/cftoken add è´¦å·B token_b_here

# æŸ¥çœ‹æ‰€æœ‰Token
/cflist

# åˆ†åˆ«å¯¼å‡ºåŸŸå
/cfexport è´¦å·A json
/cfexport è´¦å·B csv

# åˆå¹¶å¯¼å‡ºæ‰€æœ‰è´¦å·åŸŸå
/cfexportall json sync

# é€‰æ‹©ä¸»è¦è´¦å·åŒæ­¥åˆ°ç›‘æ§é…ç½®
/cfsync è´¦å·A replace
```

## ğŸŒ HTTP API æ¥å£è¯´æ˜

### æ¥å£é…ç½®
é€šè¿‡ `config.json` ä¸­çš„ `http_api` éƒ¨åˆ†é…ç½®HTTPæ¥å£ï¼š

```json
{
  "http_api": {
    "enabled": true,                    // å¯ç”¨HTTP API
    "host": "0.0.0.0",                 // ç›‘å¬åœ°å€
    "port": 8080,                      // ç›‘å¬ç«¯å£
    "cors_enabled": true,              // å¯ç”¨CORS
    "allowed_ips": [],                 // IPç™½åå•ï¼Œç©ºåˆ™å…è®¸æ‰€æœ‰
    "rate_limit": {
      "enabled": true,
      "requests_per_minute": 60        // é¢‘ç‡é™åˆ¶
    },
    "auth": {
      "enabled": true,
      "api_key": "your-api-key-here"   // APIå¯†é’¥
    }
  }
}
```

### å¯ç”¨æ¥å£

#### 1. å‘é€æ¶ˆæ¯
- **URL**: `POST /sendMsg`
- **åŠŸèƒ½**: é€šè¿‡Telegram Botå‘é€æ¶ˆæ¯
- **è®¤è¯**: éœ€è¦APIå¯†é’¥

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "msg": "æ¶ˆæ¯å†…å®¹",                    // å¿…éœ€ï¼šæ¶ˆæ¯æ–‡æœ¬
  "parse_mode": "Markdown",           // å¯é€‰ï¼šè§£ææ¨¡å¼ï¼Œé»˜è®¤Markdown
  "disable_preview": true             // å¯é€‰ï¼šç¦ç”¨é“¾æ¥é¢„è§ˆï¼Œé»˜è®¤true
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "msg_length": 12,
  "timestamp": "2024-01-01T12:00:00"
}
```

#### 2. å¥åº·æ£€æŸ¥
- **URL**: `GET /health`
- **åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡çŠ¶æ€
- **è®¤è¯**: ä¸éœ€è¦

#### 3. çŠ¶æ€æŸ¥è¯¢
- **URL**: `GET /status`
- **åŠŸèƒ½**: è·å–è¯¦ç»†çŠ¶æ€ä¿¡æ¯
- **è®¤è¯**: éœ€è¦APIå¯†é’¥

### APIå¯†é’¥ç®¡ç†
ä½¿ç”¨Telegramå‘½ä»¤ `/apikey` å¯ä»¥å¿«é€Ÿæ›´æ–°APIå¯†é’¥ï¼š
- è‡ªåŠ¨ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†é’¥
- ç«‹å³æ›´æ–°åˆ°é…ç½®æ–‡ä»¶
- æ—§å¯†é’¥ç«‹å³å¤±æ•ˆ
- æ”¯æŒæ©ç æ˜¾ç¤ºä¿æŠ¤å®‰å…¨

### ä½¿ç”¨ç¤ºä¾‹
```bash
# ä½¿ç”¨Bearer Tokenè®¤è¯å‘é€æ¶ˆæ¯
curl -X POST "http://botsite.thai2570.com:8080/sendMsg" \
     -H "Authorization: Bearer your-api-key" \
     -H "Content-Type: application/json" \
     -d '{"msg": "Hello from API!"}'

# ä½¿ç”¨X-API-Keyè®¤è¯
curl -X POST "http://botsite.thai2570.com:8080/sendMsg" \
     -H "X-API-Key: your-api-key" \
     -H "Content-Type: application/json" \
     -d '{"msg": "Test message"}'

# å¥åº·æ£€æŸ¥
curl "http://botsite.thai2570.com:8080/health"
```

## ğŸ“Š é€šçŸ¥ç³»ç»Ÿè¯´æ˜

### Smartæ¨¡å¼ï¼ˆæ™ºèƒ½é€šçŸ¥ï¼‰- æ¨è
- **åªé€šçŸ¥å˜åŒ–**ï¼šä»…åœ¨æœ‰æ–°é”™è¯¯æˆ–æ¢å¤æ—¶å‘é€é€šçŸ¥
- **ç®€æ´æ˜äº†**ï¼šé‡ç‚¹å…³æ³¨çŠ¶æ€å˜åŒ–ï¼Œå‡å°‘ä¿¡æ¯å™ªéŸ³
- **é€‚åˆåœºæ™¯**ï¼šé•¿æœŸç¨³å®šç›‘æ§ï¼Œå…³æ³¨é—®é¢˜å˜åŒ–

#### ç¤ºä¾‹é€šçŸ¥
```
ğŸ”” çŠ¶æ€å˜åŒ–é€šçŸ¥

ğŸ†• æ–°å‡ºç°é—®é¢˜ (2ä¸ª):
â€¢ example1.com - Cloudflareé”™è¯¯ (522è¿æ¥è¶…æ—¶)  
â€¢ example2.com - ç½‘å…³é”™è¯¯ (502åç½‘å…³)

âœ… å·²æ¢å¤æ­£å¸¸ (1ä¸ª):
â€¢ example3.com

ğŸ“Š å½“å‰æ€»ä½“:
â€¢ ç›‘æ§æ€»æ•°: 68 â€¢ åœ¨çº¿æ­£å¸¸: 66 â€¢ å¼‚å¸¸åŸŸå: 2

â° 2024-01-01 12:00:00
```

### Fullæ¨¡å¼ï¼ˆå®Œæ•´é€šçŸ¥ï¼‰
- **æ¯æ¬¡éƒ½é€šçŸ¥**ï¼šæ¯æ¬¡æ£€æŸ¥å®Œæˆåéƒ½å‘é€è¯¦ç»†ç»“æœ
- **å®Œæ•´ä¿¡æ¯**ï¼šæ˜¾ç¤ºæ‰€æœ‰é”™è¯¯çš„è¯¦ç»†åˆ†ç±»
- **é€‚åˆåœºæ™¯**ï¼šè°ƒè¯•é˜¶æ®µï¼Œéœ€è¦è¯¦ç»†äº†è§£æ¯æ¬¡æ£€æŸ¥ç»“æœ

#### ç¤ºä¾‹é€šçŸ¥
```
âš ï¸ æ£€æŸ¥ç»“æœ

ğŸ“Š æ•´ä½“çŠ¶æ€
ğŸ” æ£€æŸ¥åŸŸå: 68 ä¸ª
âœ… æ­£å¸¸åœ¨çº¿: 65 ä¸ª  
âŒ å¼‚å¸¸åŸŸå: 3 ä¸ª

**âš ï¸ Cloudflareé”™è¯¯ (522è¿æ¥è¶…æ—¶) (1ä¸ª):**
  â€¢ example1.com

**âš ï¸ Cloudflareé”™è¯¯ (526SSLè¯ä¹¦æ— æ•ˆ) (1ä¸ª):**
  â€¢ example2.com

**ğŸšª ç½‘å…³é”™è¯¯ (502åç½‘å…³) (1ä¸ª):**
  â€¢ example3.com

â° 2024-01-01 12:00:00
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç³»ç»Ÿèµ„æºé…ç½®
- **å°å‹éƒ¨ç½²** (<100åŸŸå): 1æ ¸1Gå†…å­˜ï¼Œå¹¶å‘æ•°10-20
- **ä¸­å‹éƒ¨ç½²** (100-500åŸŸå): 2æ ¸2Gå†…å­˜ï¼Œå¹¶å‘æ•°30-50  
- **å¤§å‹éƒ¨ç½²** (>500åŸŸå): 4æ ¸4Gå†…å­˜ï¼Œå¹¶å‘æ•°50-100

### ä¼˜åŒ–ç‰¹æ€§
- **è¿æ¥æ± å¤ç”¨** - å‡å°‘è¿æ¥å»ºç«‹å¼€é”€
- **HTTP/2æ”¯æŒ** - æå‡ä¼ è¾“æ•ˆç‡ï¼ˆå®‰è£…h2åŒ…ï¼‰
- **æ™ºèƒ½é‡è¯•** - ä»…é‡è¯•å¯æ¢å¤çš„é”™è¯¯
- **æ‰¹é‡å¤„ç†** - åˆ†æ‰¹æ£€æŸ¥é¿å…èµ„æºè€—å°½
- **è‡ªé€‚åº”å¹¶å‘** - æ ¹æ®CPUå’Œå†…å­˜åŠ¨æ€è°ƒæ•´

### é…ç½®å»ºè®®
```json
{
  "check": {
    "max_concurrent": 20,              // æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´
    "auto_adjust_concurrent": true,    // å¯ç”¨è‡ªé€‚åº”
    "timeout_seconds": 15,             // é€‚ä¸­çš„è¶…æ—¶æ—¶é—´
    "retry_count": 2,                  // é€‚åº¦é‡è¯•
    "batch_notify": false              // å‡å°‘é€šçŸ¥é¢‘ç‡
  },
  "notification": {
    "level": "smart",                  // ä½¿ç”¨æ™ºèƒ½æ¨¡å¼
    "failure_threshold": 2,            // é¿å…è¯¯æŠ¥
    "cooldown_minutes": 60             // åˆç†å†·å´æ—¶é—´
  }
}
```

## ğŸ”§ æ•…éšœæ’æŸ¥æŒ‡å—

### Telegramç›¸å…³é—®é¢˜

**1. æ¶ˆæ¯å‘é€å¤±è´¥**
- æ£€æŸ¥Bot Tokenæ˜¯å¦æ­£ç¡®ï¼ˆä»@BotFatherè·å–ï¼‰
- ç¡®è®¤Chat IDæ ¼å¼æ­£ç¡®ï¼ˆç¾¤ç»„IDä¸ºè´Ÿæ•°ï¼‰
- éªŒè¯æœºå™¨äººå·²åŠ å…¥ç¾¤ç»„å¹¶å…·æœ‰å‘é€æƒé™

**2. å‘½ä»¤æ— å“åº”**  
- æ£€æŸ¥æœºå™¨äººæ˜¯å¦åœ¨çº¿
- ç¡®è®¤ç”¨æˆ·åœ¨admin_usersåˆ—è¡¨ä¸­ï¼ˆå¦‚æœè®¾ç½®äº†ï¼‰
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ£€æŸ¥é”™è¯¯ä¿¡æ¯

### åŸŸåæ£€æŸ¥é—®é¢˜

**1. æ£€æŸ¥è¶…æ—¶é¢‘ç¹**
- å¢åŠ `timeout_seconds`é…ç½®ï¼ˆå»ºè®®15-30ç§’ï¼‰
- å‡å°‘`max_concurrent`å¹¶å‘æ•°
- æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§
- å¯ç”¨`auto_adjust_concurrent`è‡ªé€‚åº”åŠŸèƒ½

**2. å†…å­˜å ç”¨è¿‡é«˜**
- å¯ç”¨`auto_adjust_concurrent`è‡ªé€‚åº”å¹¶å‘
- å‡å°‘`max_concurrent`å€¼
- æ£€æŸ¥åŸŸååˆ—è¡¨æ˜¯å¦è¿‡å¤§ï¼ˆå»ºè®®<1000ä¸ªï¼‰
- å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶

### Cloudflareé›†æˆé—®é¢˜

**1. TokenéªŒè¯å¤±è´¥**
- æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆä¸å«ç©ºæ ¼ï¼‰
- ç¡®è®¤Tokenæƒé™è®¾ç½®ï¼ˆZone:Read, DNS:Readï¼‰
- éªŒè¯Tokenæ˜¯å¦è¿‡æœŸæˆ–è¢«æ’¤é”€

**2. åŸŸåè·å–å¤±è´¥**
- æ£€æŸ¥ç½‘ç»œè¿æ¥åˆ°Cloudflare API
- ç¡®è®¤Tokenæœ‰å¯¹åº”åŸŸåçš„è®¿é—®æƒé™
- æ£€æŸ¥Cloudflare APIæœåŠ¡çŠ¶æ€

### ç³»ç»Ÿè¿è¡Œé—®é¢˜

**1. æœåŠ¡å¯åŠ¨å¤±è´¥**
- æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.8+ï¼‰
- ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
- æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼ï¼ˆJSONè¯­æ³•ï¼‰
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

**2. é…ç½®çƒ­é‡è½½å¤±è´¥**
- æ£€æŸ¥é…ç½®æ–‡ä»¶JSONæ ¼å¼
- ç¡®è®¤æ–‡ä»¶æƒé™å¯è¯»å†™
- é‡å¯æœåŠ¡ä»¥åº”ç”¨æ‰€æœ‰æ›´æ”¹

## ğŸ“š å­¦ä¹ è·¯å¾„

### æ–°æ‰‹å…¥é—¨
1. **ç¯å¢ƒå‡†å¤‡** - å®‰è£…Pythonå’Œä¾èµ–åŒ…
2. **åŸºç¡€é…ç½®** - è®¾ç½®Telegram Botå’ŒåŸºæœ¬ç›‘æ§
3. **è¿è¡Œæµ‹è¯•** - æ·»åŠ å°‘é‡åŸŸåè¿›è¡Œæµ‹è¯•
4. **ç†Ÿæ‚‰å‘½ä»¤** - å­¦ä¹ åŸºæœ¬çš„Telegramå‘½ä»¤æ“ä½œ

### è¿›é˜¶ä½¿ç”¨  
1. **æ€§èƒ½ä¼˜åŒ–** - è°ƒæ•´å¹¶å‘æ•°å’Œè¶…æ—¶é…ç½®
2. **é€šçŸ¥ä¼˜åŒ–** - é…ç½®æ™ºèƒ½é€šçŸ¥å’Œå†·å´æ—¶é—´
3. **Cloudflareé›†æˆ** - è¿æ¥CFè´¦å·æ‰¹é‡ç®¡ç†åŸŸå
4. **ç”Ÿäº§éƒ¨ç½²** - ä½¿ç”¨systemdæˆ–Dockeréƒ¨ç½²

### ä¸“å®¶çº§é…ç½®
1. **å¤§è§„æ¨¡ç›‘æ§** - ä¼˜åŒ–å¤§é‡åŸŸåçš„ç›‘æ§æ€§èƒ½
2. **å¤šè´¦å·ç®¡ç†** - ç®¡ç†å¤šä¸ªCFè´¦å·å’ŒToken
3. **è‡ªå®šä¹‰å¼€å‘** - åŸºäºAPIè¿›è¡ŒäºŒæ¬¡å¼€å‘
4. **ç›‘æ§æŠ¥è­¦** - é›†æˆå…¶ä»–ç›‘æ§ç³»ç»Ÿ

## ğŸ’¡ æœ€ä½³å®è·µ

### ç›‘æ§é…ç½®
- ä½¿ç”¨åˆç†çš„æ£€æŸ¥é—´éš”ï¼ˆæ¨è30åˆ†é’Ÿï¼‰
- å¯ç”¨è‡ªé€‚åº”å¹¶å‘æ§åˆ¶
- è®¾ç½®é€‚å½“çš„å¤±è´¥é˜ˆå€¼é¿å…è¯¯æŠ¥
- ä½¿ç”¨æ™ºèƒ½é€šçŸ¥æ¨¡å¼å‡å°‘å™ªéŸ³

### å®‰å…¨å»ºè®®
- å®šæœŸè½®æ¢Cloudflare API Token
- é™åˆ¶Telegramç®¡ç†å‘˜ç”¨æˆ·
- ä½¿ç”¨æœ€å°æƒé™åŸåˆ™é…ç½®Token
- å®šæœŸæ£€æŸ¥å’Œæ¸…ç†ä¸ç”¨çš„é…ç½®

### è¿ç»´å»ºè®®  
- å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶
- æµ‹è¯•ç¾éš¾æ¢å¤æµç¨‹

## ğŸ“„ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å—
- **DomainMonitor** - ä¸»ç¨‹åºåè°ƒå™¨ï¼Œç®¡ç†æ•´ä¸ªç›‘æ§æµç¨‹
- **DomainChecker** - å¼‚æ­¥åŸŸåæ£€æµ‹å¼•æ“ï¼Œè´Ÿè´£å¹¶å‘æ£€æŸ¥
- **TelegramBot** - æœºå™¨äººå‘½ä»¤å¤„ç†å™¨ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’
- **TelegramNotifier** - é€šçŸ¥å‘é€å™¨ï¼Œæ™ºèƒ½é€šçŸ¥ç®¡ç†
- **ConfigManager** - é…ç½®ç®¡ç†å™¨ï¼Œæ”¯æŒçƒ­é‡è½½åŠŸèƒ½
- **CloudflareManager** - CF APIç®¡ç†å™¨ï¼ŒTokenå’ŒåŸŸåç®¡ç†
- **ErrorTracker** - é”™è¯¯ç»Ÿè®¡è¿½è¸ªå™¨ï¼Œåˆ†æå¤±è´¥æ¨¡å¼

### æŠ€æœ¯ç‰¹ç‚¹
- **å¼‚æ­¥æ¶æ„** - åŸºäºasyncioçš„é«˜æ€§èƒ½å¼‚æ­¥å¤„ç†
- **è¿æ¥æ± ç®¡ç†** - HTTPè¿æ¥å¤ç”¨æå‡æ•ˆç‡  
- **æ™ºèƒ½é‡è¯•** - åŒºåˆ†é”™è¯¯ç±»å‹è¿›è¡Œæœ‰é€‰æ‹©é‡è¯•
- **è‡ªé€‚åº”æ§åˆ¶** - æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´å¹¶å‘
- **çƒ­é…ç½®æ›´æ–°** - æ— éœ€é‡å¯å³å¯æ›´æ–°å¤§éƒ¨åˆ†é…ç½®
- **æ¨¡å—åŒ–è®¾è®¡** - æ¾è€¦åˆçš„æ¨¡å—åŒ–æ¶æ„ä¾¿äºæ‰©å±•

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.1.0 - Cloudflareé›†æˆç‰ˆæœ¬
- âœ… é›†æˆCloudflare APIåŠŸèƒ½
- âœ… å¤šç”¨æˆ·Tokenç®¡ç†ç³»ç»Ÿ
- âœ… åŸŸåæ‰¹é‡æ“ä½œï¼ˆè·å–/å¯¼å‡º/åŒæ­¥ï¼‰
- âœ… å¤–éƒ¨åŸŸåæ–‡ä»¶æ”¯æŒ
- âœ… æ‰©å±•Telegramå‘½ä»¤é›†

### v1.0.0 - åŸºç¡€ç›‘æ§ç‰ˆæœ¬
- âœ… å¼‚æ­¥åŸŸåæ‰¹é‡ç›‘æ§
- âœ… Telegram Botæ§åˆ¶
- âœ… æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ
- âœ… é…ç½®çƒ­é‡è½½
- âœ… ç”Ÿäº§éƒ¨ç½²æ”¯æŒ

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼æäº¤PRå‰è¯·ç¡®ä¿ï¼š
- ä»£ç ç¬¦åˆé¡¹ç›®é£æ ¼
- æ·»åŠ å¿…è¦çš„æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- é€šè¿‡æ‰€æœ‰æ£€æŸ¥

## ğŸ“§ æ”¯æŒä¸åé¦ˆ

- **Issues**: ä½¿ç”¨GitHub IssuesæŠ¥å‘Šé—®é¢˜
- **è®¨è®º**: GitHub Discussionsè¿›è¡ŒæŠ€æœ¯è®¨è®º  
- **æ–‡æ¡£**: æŸ¥çœ‹æœ¬READMEè·å–è¯¦ç»†ä¿¡æ¯

---

**å¿«é€Ÿå¼€å§‹**ï¼šå¤åˆ¶`config_example.json`åˆ°`config.json`ï¼Œå¡«å…¥Bot Tokenå’ŒChat IDï¼Œè¿è¡Œ`python src/main.py`å¼€å§‹ä½¿ç”¨ï¼