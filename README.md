# åŸŸåç›‘æ§æœåŠ¡ (Domain Monitor)

ä¸€ä¸ªåŸºäº Python çš„å¼‚æ­¥åŸŸåç›‘æ§æœåŠ¡ï¼Œæ”¯æŒæ‰¹é‡æ£€æŸ¥åŸŸåå¯ç”¨æ€§å¹¶é€šè¿‡ Telegram Bot å‘é€é€šçŸ¥ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ” **æ‰¹é‡åŸŸåç›‘æ§** - æ”¯æŒåŒæ—¶ç›‘æ§æ•°ç™¾ä¸ªåŸŸå
- âš¡ **é«˜æ€§èƒ½å¼‚æ­¥æ£€æŸ¥** - ä½¿ç”¨ asyncio å’Œè¿æ¥æ± æŠ€æœ¯
- ğŸ“± **Telegram æœºå™¨äºº** - å®æ—¶é€šçŸ¥å’Œè¿œç¨‹æ§åˆ¶
- ğŸ”„ **è‡ªé€‚åº”å¹¶å‘** - æ ¹æ®ç³»ç»Ÿèµ„æºè‡ªåŠ¨è°ƒæ•´å¹¶å‘æ•°
- ğŸ“Š **æ™ºèƒ½é‡è¯•** - ä»…å¯¹è¶…æ—¶å’Œè¿æ¥é”™è¯¯è¿›è¡Œé‡è¯•
- ğŸ¯ **çµæ´»é…ç½®** - æ”¯æŒçƒ­é‡è½½ï¼Œæ— éœ€é‡å¯æœåŠ¡
- ğŸ“ˆ **è¿›åº¦æ˜¾ç¤º** - å®æ—¶æ˜¾ç¤ºæ£€æŸ¥è¿›åº¦å’Œé¢„è®¡å®Œæˆæ—¶é—´
- ğŸ›¡ï¸ **ç”Ÿäº§å°±ç»ª** - æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼ˆsystemd/Docker/PM2ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository_url>
cd domain-monitor
```

### 2. å®‰è£…ä¾èµ–
```bash
# Windows
scripts\install_deps.bat

# Linux/Mac
pip install -r requirements.txt
```

### 3. é…ç½®æœåŠ¡
å¤åˆ¶é…ç½®ç¤ºä¾‹å¹¶ç¼–è¾‘ï¼š
```bash
cp config_example.json config.json
```

ç¼–è¾‘ `config.json`ï¼Œå¡«å…¥ä½ çš„ Telegram Bot Token å’Œ Chat IDï¼š
```json
{
  "telegram": {
    "bot_token": "YOUR_BOT_TOKEN",
    "chat_id": "YOUR_CHAT_ID"
  }
}
```

### 4. è¿è¡ŒæœåŠ¡

#### å¼€å‘ç¯å¢ƒ
```bash
python src/main.py
```

#### ç”Ÿäº§ç¯å¢ƒ
- **Linux**: `sudo deployment/deploy.sh systemd`
- **Docker**: `docker-compose -f deployment/docker-compose.yml up -d`
- **Windows**: `deployment\run_production.bat`

## ğŸ“ é¡¹ç›®ç»“æ„

```
domain-monitor/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.py            # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ domain_checker.py  # åŸŸåæ£€æŸ¥æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ telegram_bot.py    # Telegramæœºå™¨äººæ¨¡å—
â”‚   â”œâ”€â”€ telegram_notifier.py # é€šçŸ¥å‘é€æ¨¡å—
â”‚   â””â”€â”€ config_manager.py  # é…ç½®ç®¡ç†æ¨¡å—
â”œâ”€â”€ deployment/            # éƒ¨ç½²ç›¸å…³æ–‡ä»¶
â”‚   â”œâ”€â”€ docker-compose.yml # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile         # Dockeré•œåƒ
â”‚   â”œâ”€â”€ domain-monitor.service # systemdæœåŠ¡
â”‚   â”œâ”€â”€ deploy.sh          # Linuxéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ run_production.bat # Windowså¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ ecosystem.config.js # PM2é…ç½®
â”œâ”€â”€ scripts/              # å®ç”¨è„šæœ¬
â”‚   â””â”€â”€ install_deps.bat # ä¾èµ–å®‰è£…è„šæœ¬
â”œâ”€â”€ docs/                 # æ–‡æ¡£
â”‚   â”œâ”€â”€ CONFIG_GUIDE.md  # é…ç½®æŒ‡å—
â”‚   â””â”€â”€ OPTIMIZATION.md  # ä¼˜åŒ–è¯´æ˜
â”œâ”€â”€ config.json          # é…ç½®æ–‡ä»¶ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ config_example.json  # é…ç½®ç¤ºä¾‹
â””â”€â”€ requirements.txt     # Pythonä¾èµ–
```

## ğŸ¤– Telegram æœºå™¨äººå‘½ä»¤

### åŸºç¡€å‘½ä»¤
- `/help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `/status` - æŸ¥çœ‹ç›‘æ§çŠ¶æ€
- `/list` - æŸ¥çœ‹æ‰€æœ‰ç›‘æ§åŸŸå

### åŸŸåç®¡ç†
- `/add example.com` - æ·»åŠ åŸŸåï¼ˆæ”¯æŒæ‰¹é‡ï¼‰
- `/remove example.com` - åˆ é™¤åŸŸåï¼ˆæ”¯æŒæ‰¹é‡ï¼‰
- `/clear` - æ¸…ç©ºæ‰€æœ‰åŸŸå
- `/check` - ç«‹å³æ‰§è¡Œæ£€æŸ¥

### é…ç½®ç®¡ç†
- `/config` - æ˜¾ç¤ºå½“å‰é…ç½®
- `/interval 10` - è®¾ç½®æ£€æŸ¥é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
- `/timeout 15` - è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
- `/retry 2` - è®¾ç½®é‡è¯•æ¬¡æ•°
- `/reload` - é‡æ–°åŠ è½½é…ç½®

### ç®¡ç†å‘˜å‘½ä»¤
- `/admin add @username` - æ·»åŠ ç®¡ç†å‘˜
- `/admin remove @username` - ç§»é™¤ç®¡ç†å‘˜
- `/stop` - åœæ­¢ç›‘æ§æœåŠ¡

## âš™ï¸ é…ç½®è¯´æ˜

### æ ¸å¿ƒé…ç½®
```json
{
  "telegram": {
    "bot_token": "Bot Token",
    "chat_id": "ç¾¤ç»„ID",
    "admin_users": ["@admin1", "@admin2"]
  },
  "check": {
    "interval_minutes": 30,        // æ£€æŸ¥é—´éš”
    "max_concurrent": 10,           // æœ€å¤§å¹¶å‘æ•°
    "timeout_seconds": 14,          // è¶…æ—¶æ—¶é—´
    "retry_count": 2,               // é‡è¯•æ¬¡æ•°
    "auto_adjust_concurrent": true  // è‡ªé€‚åº”å¹¶å‘
  },
  "domains": [
    "example.com",
    "test.com"
  ],
  "notification": {
    "notify_on_recovery": true,    // æ¢å¤æ—¶é€šçŸ¥
    "failure_threshold": 1,        // å¤±è´¥é˜ˆå€¼
    "cooldown_minutes": 20         // å†·å´æ—¶é—´
  }
}
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è§ [é…ç½®æŒ‡å—](docs/CONFIG_GUIDE.md)

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- **è¿æ¥æ± å¤ç”¨** - å‡å°‘è¿æ¥å»ºç«‹å¼€é”€
- **HTTP/2æ”¯æŒ** - æå‡ä¼ è¾“æ•ˆç‡ï¼ˆéœ€å®‰è£…h2ï¼‰
- **æ™ºèƒ½é‡è¯•** - ä»…é‡è¯•å¯æ¢å¤çš„é”™è¯¯
- **æ‰¹é‡å¤„ç†** - åˆ†æ‰¹æ£€æŸ¥é¿å…èµ„æºè€—å°½
- **è‡ªé€‚åº”å¹¶å‘** - æ ¹æ®CPUå’Œå†…å­˜åŠ¨æ€è°ƒæ•´

### æ¨èé…ç½®
- **å°å‹éƒ¨ç½²** (<100åŸŸå): 1æ ¸1Gå†…å­˜
- **ä¸­å‹éƒ¨ç½²** (100-500åŸŸå): 2æ ¸2Gå†…å­˜
- **å¤§å‹éƒ¨ç½²** (>500åŸŸå): 4æ ¸4Gå†…å­˜

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **Telegramæ¶ˆæ¯å‘é€å¤±è´¥**
   - æ£€æŸ¥ Bot Token æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ Chat ID æ ¼å¼æ­£ç¡®ï¼ˆç¾¤ç»„IDåº”ä¸ºè´Ÿæ•°ï¼‰
   - éªŒè¯æœºå™¨äººå·²åŠ å…¥ç¾¤ç»„å¹¶æœ‰å‘é€æƒé™

2. **åŸŸåæ£€æŸ¥è¶…æ—¶**
   - å¢åŠ  timeout_seconds é…ç½®
   - å‡å°‘ max_concurrent å¹¶å‘æ•°
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

3. **å†…å­˜å ç”¨è¿‡é«˜**
   - å¯ç”¨ auto_adjust_concurrent
   - å‡å°‘ max_concurrent å€¼
   - æ£€æŸ¥åŸŸååˆ—è¡¨æ˜¯å¦è¿‡å¤§

## ğŸ“ˆ ç›‘æ§æ¶ˆæ¯ç¤ºä¾‹

### æ£€æŸ¥å®Œæˆé€šçŸ¥
```
âš ï¸ åŸŸåæ£€æŸ¥å®Œæˆ

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯
ğŸ” æ£€æŸ¥æ€»æ•°: 68 ä¸ª
âœ… æ­£å¸¸: 65 ä¸ª
âŒ å¼‚å¸¸: 3 ä¸ª

â±ï¸ è¯·æ±‚è¶…æ—¶ (2ä¸ª):
  â€¢ example1.com (è¯·æ±‚è¶…æ—¶ï¼ˆ14ç§’ï¼Œå·²é‡è¯•2æ¬¡ï¼‰)
  â€¢ example2.com (è¿æ¥å»ºç«‹è¶…æ—¶ï¼ˆ14ç§’ï¼Œå·²é‡è¯•1æ¬¡ï¼‰)

âŒ HTTPé”™è¯¯ (1ä¸ª):
  â€¢ example3.com [526]

â° 2024-01-01 12:00:00
```

## ğŸ“ å¼€å‘è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- pip
- venvï¼ˆæ¨èï¼‰

### æ ¸å¿ƒæ¨¡å—
- `DomainMonitor` - ä¸»ç¨‹åºåè°ƒå™¨
- `DomainChecker` - åŸŸåæ£€æµ‹å¼•æ“
- `TelegramBot` - æœºå™¨äººå‘½ä»¤å¤„ç†
- `TelegramNotifier` - é€šçŸ¥å‘é€å™¨
- `ConfigManager` - é…ç½®ç®¡ç†å™¨

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚