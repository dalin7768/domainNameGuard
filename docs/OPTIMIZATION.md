# æ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸš€ ä¼˜åŒ–ç‰¹æ€§

### 1. è¿æ¥æ± å¤ç”¨
- ä½¿ç”¨ `httpx.AsyncClient` ç»´æŒé•¿è¿æ¥
- å‡å°‘ TCP æ¡æ‰‹å¼€é”€
- æ”¯æŒ HTTP/2 å¤šè·¯å¤ç”¨

### 2. æ‰¹é‡å¹¶å‘å¤„ç†
- åˆ†æ‰¹æ‰§è¡Œé¿å…èµ„æºè€—å°½
- å¯é…ç½®æœ€å¤§å¹¶å‘æ•°
- æ™ºèƒ½ä»»åŠ¡è°ƒåº¦

### 3. è‡ªé€‚åº”å¹¶å‘æ§åˆ¶
- æ ¹æ® CPU ä½¿ç”¨ç‡åŠ¨æ€è°ƒæ•´
- æ ¹æ®å†…å­˜ä½¿ç”¨ç‡è‡ªåŠ¨é™åˆ¶
- é˜²æ­¢ç³»ç»Ÿè¿‡è½½

### 4. æ™ºèƒ½é‡è¯•æœºåˆ¶
- ä»…é‡è¯•å¯æ¢å¤é”™è¯¯ï¼ˆè¶…æ—¶ã€è¿æ¥é”™è¯¯ï¼‰
- ä¸é‡è¯•æ°¸ä¹…æ€§é”™è¯¯ï¼ˆDNSã€HTTPé”™è¯¯ã€SSLé”™è¯¯ï¼‰
- èŠ‚çœæ£€æŸ¥æ—¶é—´

## âš™ï¸ é…ç½®ä¼˜åŒ–

### å°è§„æ¨¡éƒ¨ç½²ï¼ˆ<100 åŸŸåï¼‰
```json
{
  "check": {
    "interval_minutes": 30,
    "max_concurrent": 10,
    "timeout_seconds": 10,
    "retry_count": 2,
    "auto_adjust_concurrent": false
  }
}
```
- èµ„æºéœ€æ±‚ï¼š1æ ¸ 1Gå†…å­˜
- æ£€æŸ¥è€—æ—¶ï¼šçº¦1-2åˆ†é’Ÿ

### ä¸­ç­‰è§„æ¨¡ï¼ˆ100-500 åŸŸåï¼‰
```json
{
  "check": {
    "interval_minutes": 20,
    "max_concurrent": 30,
    "timeout_seconds": 8,
    "retry_count": 1,
    "auto_adjust_concurrent": true
  }
}
```
- èµ„æºéœ€æ±‚ï¼š2æ ¸ 2Gå†…å­˜
- æ£€æŸ¥è€—æ—¶ï¼šçº¦3-5åˆ†é’Ÿ

### å¤§è§„æ¨¡éƒ¨ç½²ï¼ˆ>500 åŸŸåï¼‰
```json
{
  "check": {
    "interval_minutes": 10,
    "max_concurrent": 50,
    "timeout_seconds": 5,
    "retry_count": 1,
    "auto_adjust_concurrent": true,
    "batch_notify": false
  }
}
```
- èµ„æºéœ€æ±‚ï¼š4æ ¸ 4Gå†…å­˜
- æ£€æŸ¥è€—æ—¶ï¼šçº¦5-10åˆ†é’Ÿ

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å¹¶å‘æ•°å½±å“
| å¹¶å‘æ•° | 100åŸŸåè€—æ—¶ | 500åŸŸåè€—æ—¶ | CPUä½¿ç”¨ç‡ | å†…å­˜ä½¿ç”¨ |
|--------|-------------|-------------|-----------|----------|
| 10 | 60ç§’ | 300ç§’ | 20% | 100MB |
| 20 | 30ç§’ | 150ç§’ | 40% | 150MB |
| 50 | 15ç§’ | 60ç§’ | 70% | 250MB |
| 100 | 10ç§’ | 30ç§’ | 90% | 400MB |

### è¶…æ—¶è®¾ç½®å½±å“
- 5ç§’ï¼šå¿«é€Ÿå¤±è´¥ï¼Œå¯èƒ½è¯¯æŠ¥
- 10ç§’ï¼šå¹³è¡¡é€‰æ‹©ï¼ˆæ¨èï¼‰
- 15ç§’ï¼šå®½æ¾ï¼Œå‡å°‘è¯¯æŠ¥
- 30ç§’ï¼šéå¸¸å®½æ¾ï¼Œé€‚åˆç½‘ç»œå·®ç¯å¢ƒ

## ğŸ”§ ä¼˜åŒ–æŠ€å·§

### 1. HTTP/2 ä¼˜åŒ–
å®‰è£… h2 åŒ…å¯ç”¨ HTTP/2ï¼š
```bash
pip install h2
```
ä¼˜åŠ¿ï¼š
- å¤šè·¯å¤ç”¨å‡å°‘è¿æ¥æ•°
- å¤´éƒ¨å‹ç¼©å‡å°‘ä¼ è¾“é‡
- æœåŠ¡å™¨æ¨é€ï¼ˆå¦‚æ”¯æŒï¼‰

### 2. ç³»ç»Ÿä¼˜åŒ–

#### Linux å†…æ ¸å‚æ•°
```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
ulimit -n 65535

# ä¼˜åŒ– TCP å‚æ•°
sysctl -w net.ipv4.tcp_fin_timeout=30
sysctl -w net.ipv4.tcp_keepalive_time=1200
sysctl -w net.core.somaxconn=1024
```

#### Windows ä¼˜åŒ–
- å¢åŠ çº¿ç¨‹æ± å¤§å°
- è°ƒæ•´ TCP åŠ¨æ€ç«¯å£èŒƒå›´
- ç¦ç”¨ä¸å¿…è¦çš„ç½‘ç»œåè®®

### 3. ä»£ç çº§ä¼˜åŒ–

#### æ‰¹å¤„ç†ä¼˜åŒ–
```python
# å½“å‰å®ç°
batch_size = max_concurrent
batches = (total_domains + batch_size - 1) // batch_size
```

#### ç¼“å­˜ä¼˜åŒ–
- LRU ç¼“å­˜æœ€è¿‘1000ä¸ªåŸŸåçŠ¶æ€
- é¿å…å†…å­˜æ— é™å¢é•¿
- è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®

### 4. ç½‘ç»œä¼˜åŒ–

#### DNS ä¼˜åŒ–
- ä½¿ç”¨æœ¬åœ° DNS ç¼“å­˜
- é…ç½®å¤šä¸ª DNS æœåŠ¡å™¨
- è€ƒè™‘ä½¿ç”¨ DoH/DoT

#### ä»£ç†è®¾ç½®
```python
# å¦‚éœ€ä»£ç†
client = httpx.AsyncClient(
    proxy="http://proxy.example.com:8080"
)
```

## ğŸ“ˆ ç›‘æ§å»ºè®®

### å…³é”®æŒ‡æ ‡
1. **æ£€æŸ¥è€—æ—¶**ï¼šæ¯è½®æ£€æŸ¥æ€»æ—¶é—´
2. **æˆåŠŸç‡**ï¼šæ­£å¸¸åŸŸåç™¾åˆ†æ¯”
3. **å“åº”æ—¶é—´**ï¼šå¹³å‡å“åº”æ—¶é—´
4. **èµ„æºä½¿ç”¨**ï¼šCPU/å†…å­˜å ç”¨

### å‘Šè­¦é˜ˆå€¼
- æ£€æŸ¥è€—æ—¶ > interval_minutes * 0.8
- CPU ä½¿ç”¨ç‡ > 80%
- å†…å­˜ä½¿ç”¨ > 1GB
- å¤±è´¥ç‡ > 10%

## ğŸ¯ æœ€ä½³å®è·µ

### DO âœ…
1. æ ¹æ®åŸŸåæ•°é‡è°ƒæ•´å¹¶å‘æ•°
2. å¯ç”¨è‡ªé€‚åº”å¹¶å‘æ§åˆ¶
3. åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
4. å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶
5. ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨

### DON'T âŒ
1. å¹¶å‘æ•°è®¾ç½®è¿‡é«˜ï¼ˆ>100ï¼‰
2. è¶…æ—¶æ—¶é—´è¿‡çŸ­ï¼ˆ<3ç§’ï¼‰
3. é‡è¯•æ¬¡æ•°è¿‡å¤šï¼ˆ>5ï¼‰
4. å¿½ç•¥ç³»ç»Ÿèµ„æºé™åˆ¶
5. ä¸è®¾ç½®å‘Šè­¦å†·å´æ—¶é—´

## ğŸ”¬ æ€§èƒ½æµ‹è¯•

### æµ‹è¯•è„šæœ¬
```python
# æµ‹è¯•ä¸åŒå¹¶å‘æ•°çš„æ€§èƒ½
import time
import asyncio
from domain_checker import DomainChecker

async def test_performance():
    checker = DomainChecker()
    domains = ["example.com"] * 100  # 100ä¸ªåŸŸå
    
    for concurrent in [10, 20, 50]:
        checker.max_concurrent = concurrent
        start = time.time()
        await checker.check_domains_batch(domains)
        elapsed = time.time() - start
        print(f"å¹¶å‘{concurrent}: {elapsed:.2f}ç§’")

asyncio.run(test_performance())
```

### å‹åŠ›æµ‹è¯•
```bash
# æ¨¡æ‹Ÿå¤§é‡åŸŸå
python -c "
domains = ['test{}.com'.format(i) for i in range(1000)]
import json
with open('test_domains.json', 'w') as f:
    json.dump({'domains': domains}, f)
"
```

## ğŸ†˜ å¸¸è§æ€§èƒ½é—®é¢˜

### é—®é¢˜1ï¼šæ£€æŸ¥æ—¶é—´è¿‡é•¿
**ç—‡çŠ¶**ï¼šæ£€æŸ¥è€—æ—¶è¶…è¿‡é—´éš”æ—¶é—´
**è§£å†³**ï¼š
1. å¢åŠ  max_concurrent
2. å‡å°‘ timeout_seconds
3. å‡å°‘ retry_count
4. å¯ç”¨ auto_adjust_concurrent

### é—®é¢˜2ï¼šå†…å­˜å ç”¨è¿‡é«˜
**ç—‡çŠ¶**ï¼šå†…å­˜ä½¿ç”¨æŒç»­å¢é•¿
**è§£å†³**ï¼š
1. å‡å°‘ max_concurrent
2. æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼
3. å®šæœŸé‡å¯æœåŠ¡
4. ä½¿ç”¨æ›´å¤§å†…å­˜æœåŠ¡å™¨

### é—®é¢˜3ï¼šCPU ä½¿ç”¨ç‡è¿‡é«˜
**ç—‡çŠ¶**ï¼šCPU æŒç»­ 90%+
**è§£å†³**ï¼š
1. å‡å°‘ max_concurrent
2. å¢åŠ æ£€æŸ¥é—´éš”
3. ä¼˜åŒ–ä»£ç é€»è¾‘
4. å‡çº§æœåŠ¡å™¨é…ç½®

### é—®é¢˜4ï¼šç½‘ç»œé”™è¯¯é¢‘ç¹
**ç—‡çŠ¶**ï¼šå¤§é‡è¶…æ—¶æˆ–è¿æ¥é”™è¯¯
**è§£å†³**ï¼š
1. æ£€æŸ¥ç½‘ç»œå¸¦å®½
2. å¢åŠ  timeout_seconds
3. å‡å°‘ max_concurrent
4. ä½¿ç”¨æ›´ç¨³å®šçš„ç½‘ç»œ

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [Python asyncio æœ€ä½³å®è·µ](https://docs.python.org/3/library/asyncio.html)
- [HTTP/2 æ€§èƒ½ä¼˜åŒ–](https://http2.github.io/)
- [Linux ç½‘ç»œè°ƒä¼˜](https://www.kernel.org/doc/Documentation/networking/)
- [ç³»ç»Ÿæ€§èƒ½ç›‘æ§å·¥å…·](https://github.com/giampaolo/psutil)